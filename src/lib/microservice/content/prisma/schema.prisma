// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "../../../../../node_modules/.prisma/content"
}

datasource db {
    provider = "mongodb"
    url      = env("MONGODB_CONTENT_URL")
}

enum AvailableStatus {
    Active
    Drafted
    Trashed
}

enum CommentStatus {
    Active
    Pending
    Trashed
}

type User {
    id        String  @db.ObjectId
    name      String?
    username  String?
    email     String?
    avatarUrl String?
}

type Metadata {
    title       String?
    description String?
    image       String?
    author      String?
    robot       String?
    index       String?
}

type PostLike {
    id       String  @db.ObjectId
    name     String
    path     String
    imageUrl String?
    author   User?
}

model Category {
    id          String          @id @default(auto()) @map("_id") @db.ObjectId
    parentId    String?         @db.ObjectId
    status      AvailableStatus @default(Drafted)
    name        String
    path        String
    description String?
    createdAt   DateTime        @default(now())
    updatedAt   DateTime?       @updatedAt
    metadata    Metadata?
    author      User?
    editor      User?
    posts       Post[]
}

model Post {
    id          String          @id @default(auto()) @map("_id") @db.ObjectId
    categoryId  String?         @db.ObjectId
    category    Category?       @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    status      AvailableStatus @default(Drafted)
    name        String
    path        String
    imageUrl    String?
    description String?
    metadata    Metadata?
    createdAt   DateTime        @default(now())
    updatedAt   DateTime?       @updatedAt
    author      User?
    editor      User?
    postsTags   PostTag[]
}

model Tag {
    id        String          @id @default(auto()) @map("_id") @db.ObjectId
    status    AvailableStatus @default(Drafted)
    name      String          @unique
    createdAt DateTime        @default(now())
    updatedAt DateTime?       @updatedAt
    author    User?
    editor    User?
    postsTags PostTag[]
}

model PostTag {
    id     String @id @default(auto()) @map("_id") @db.ObjectId
    postId String @db.ObjectId
    post   Post   @relation(fields: [postId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    tagId  String @db.ObjectId
    tag    Tag    @relation(fields: [tagId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Comment {
    id        String        @id @default(auto()) @map("_id") @db.ObjectId
    status    CommentStatus @default(Pending)
    post      PostLike
    message   String
    createdAt DateTime      @default(now())
    updatedAt DateTime?     @updatedAt
    author    User?
    editor    User?
    parentId  String?       @db.ObjectId
    parent    Comment?      @relation(name: "NestedComment", fields: [parentId], references: [id], onUpdate: NoAction, onDelete: NoAction)
    children  Comment[]     @relation(name: "NestedComment")
}
